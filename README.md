# Async Utilities

[![Dwolla/async-utils CI](https://github.com/Dwolla/async-utils/actions/workflows/ci.yml/badge.svg)](https://github.com/Dwolla/async-utils/actions)
[![license](https://img.shields.io/github/license/Dwolla/async-utils.svg)](https://github.com/Dwolla/async-utils/blob/main/LICENSE.txt)
[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/dwolla/async-utils)](https://github.com/Dwolla/async-utils/releases)

## Use `ReaderT` for safely converting `Future`-based traits to cats-effect

You have a higher-kinded trait like this:

```scala
trait FooService[F[_]] {
  def foo(i: Int): F[Unit]
}
```

and an implementation in `Future`:

```scala
class FutureFoo extends FooService[Future] {
  def foo(i: Int): Future[Unit] = Future(println(i))
}
```

(Perhaps the implementation was automatically generated by a tool like [Twitter Scrooge](https://github.com/twitter/scrooge), in which case have a look at [async-utils-twitter](https://github.com/Dwolla/async-utils-twitter).)

With cats-tagless, you can auto-derive a `FunctorK[FooService]` instance and an implementation in `ReaderT[Future, FooService[Future], *]`:

```scala
object FooService {
  import cats.tagless._

  implicit def FooServiceReaderT[F[_]]: FooService[ReaderT[F, FooService[F], *]] = 
    Derive.readerT[FooService, F]
  implicit val FooServiceFunctorK: FunctorK[FooService] = Derive.functorK
}
```

These implicit instances can be automatically added to the code generated by Scrooge by running the `AddCatsTaglessInstances` scalafix rule! See below for more detail.

Now you can safely convert your `Future`-based implementation into one in `F[_] : Async`:

```scala
import cats.tagless.syntax.all._
import com.dwolla.util.async.stdlib._

val futureFoo: FooService[Future] = new FutureFoo

val fooService: FooService[IO] = futureFoo.asyncMapK[IO]
```

## Artifacts

The Group ID for each artifact is `"com.dwolla"`. All artifacts are published to Maven Central.

<table>
<thead>
<tr>
<th>Artifact</th>
<th>Description</th>
<th align="center">Cats Effect Version</th>
<th align="center">Scala 2.12</th>
<th align="center">Scala 2.13</th>
<th align="center">Scala.js</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>"async-utils-core"</code></td>
<td>Shared definition of <code>AsyncFunctorK</code> and supporting code</td>
<td align="center">3.x</td>
<td align="center"><g-emoji class="g-emoji" alias="white_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png">✅</g-emoji></td>
<td align="center"><g-emoji class="g-emoji" alias="white_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png">✅</g-emoji></td>
<td align="center"><g-emoji class="g-emoji" alias="white_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png">✅</g-emoji></td>
</tr>
<tr>
<td><code>"async-utils"</code></td>
<td>Implementation for stdlib Scala <code>Future</code></td>
<td align="center">3.x</td>
<td align="center"><g-emoji class="g-emoji" alias="white_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png">✅</g-emoji></td>
<td align="center"><g-emoji class="g-emoji" alias="white_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png">✅</g-emoji></td>
<td align="center"><g-emoji class="g-emoji" alias="white_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png">✅</g-emoji></td>
</tr>
<tr>
<td><code>"async-utils-twitter"</code></td>
<td>Implementation for Twitter <code>Future</code></td>
<td colspan="4">Moved to <a href="https://github.com/Dwolla/async-utils-twitter">Dwolla/async-utils-twitter</a>.</td>
</tr>
<tr>
<td><code>"async-utils-finagle"</code></td>
<td>Safely create Thrift clients and servers using cats-effect as the effect type</td>
<td colspan="4">Moved to <a href="https://github.com/Dwolla/async-utils-twitter">Dwolla/async-utils-twitter</a>.</td>
</tr>
<tr>
<td><code>"finagle-tagless-scalafix"</code></td>
<td>Automatically adds implicit instances needed by `asyncMapK` to the companion objects of Finagle services generated by Scrooge</td>
<td colspan="4">Moved to <a href="https://github.com/Dwolla/async-utils-twitter">Dwolla/async-utils-twitter</a>.</td>
</tr>
</tbody>
</table>

## Credits

Thanks to [Georgi Krastev and the cats-tagless project](https://github.com/typelevel/cats-tagless/pull/250/files) for the idea to use `ReaderT` in this way.
